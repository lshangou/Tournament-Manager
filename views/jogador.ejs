<%- include('./includes/header.ejs', {title: 'Operações de Jogador'}) %>
<main class="container mt-3">
  <div class="row">
    <div class="col-12">
      <h1>Operações de Jogador</h1>
      <hr>
      <h2>Criar Jogador</h2>
      <div>
        <div class="mb-3">
          <label for="jogador_name" class="form-label">Nome da Jogador</label>
          <input type="text" class="form-control" id="jogador_name" placeholder="Digite o nome...">
        </div>
        <div class="mb-3">
          <label for="jogador_data" class="form-label">Data de Nascimento</label>
          <input type="date" class="form-control" id="jogador_data">
        </div>
        <div class="mb-3">
          <label for="jogador_pais" class="form-label">País</label>
          <input type="text" class="form-control" id="jogador_pais" placeholder="Digite o país...">
        </div>
        <div class="mb-3">
          <label for="jogador_equipe_id" class="form-label">Id de Equipe</label>
          <input type="text" class="form-control" id="jogador_equipe_id" placeholder="Digite o id...">
        </div>
        <div class="mb-3">
          <label for="jogador_torneio_id" class="form-label">Id de Torneio</label>
          <input type="text" class="form-control" id="jogador_torneio_id" placeholder="Digite o id...">
        </div>
        <button class="btn btn-primary" onclick="create()">Cadastrar Jogador</button>
      </div>
      <hr>
      <h2>Lista de Jogadors</h2>
      <div id="get_jogador" class="row">
        <!-- Generated by JS -->
      </div>
    </div>
  </div>
  
  <template id="cardTemplate">
    <div class="card col-md-3">
      <div class="card-body">
        <h5 id="title" class="card-title">Card title</h5>
        <p id="text" class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
        <p id="pais" class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
        <p id="equipe_id" class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
        <p id="torneio_id" class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
        <a id="btn" onclick="del('id')" class="btn btn-danger">Deletar</a>
      </div>
    </div>
  </template>

</main>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
  get()
  function create() {
    let obj = {
      nome: document.getElementById('jogador_name').value,
      data_nascimento: document.getElementById('jogador_data').value,
      pais: document.getElementById('jogador_pais').value,
      equipe_id: document.getElementById('jogador_equipe_id').value,
      torneio_id: document.getElementById('jogador_torneio_id').value
    }
    axios.post('/jogador', obj)
    .then(function(res) {
      console.log('post', res)
    }).catch(function (error) {
      console.log(error);
    })
    .then(function () {
      alert('Jogador Criada com sucesso.')
      get()
    }); 
  }
  function get() {
    axios.get('/jogador')
    .then(function(res) {
      console.log('get', res)
      // Clean
      document.getElementById('get_jogador').innerHTML = ""
      res.data.forEach(item => {
        let template = document.querySelector('#cardTemplate')
        let title = template.content.querySelector('#title')
        let text = template.content.querySelector('#text')
        let pais = template.content.querySelector('#pais')
        let equipe_id = template.content.querySelector('#equipe_id')
        let torneio_id = template.content.querySelector('#torneio_id')
        let button = template.content.querySelector('#btn')
        title.textContent = item.nome
        Date.prototype.addDays = function(days) {
          var date = new Date(this.valueOf());
          date.setDate(date.getDate() + days);
          return date;
        }
        text.textContent = 'Data de Nascimento: ' + new Date(item.data_nascimento).addDays(1).toLocaleDateString("pt-BR")
        pais.textContent = 'País: ' + item.pais
        equipe_id.textContent = 'equipe_id: ' + item.equipe_id
        torneio_id.textContent = 'torneio_id: ' + item.torneio_id
        let clone = document.importNode(template.content, true);
        document.getElementById('get_jogador').appendChild(clone)
      })
    }).catch(function (error) {
      console.log(error);
    })
  }
  function del(id) {
    axios.delete('/jogador/' + id)
    .then(function(res) {
      console.log('delete', res)
    }).catch(function (error) {
      console.log(error);
    })
    .then(function () {
      alert('Jogador Deletada com sucesso.')
      get()
    }); 
  }
</script>
<%- include('./includes/footer.ejs') %>