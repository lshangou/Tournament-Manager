<%- include('./includes/header.ejs', {title: 'Operações de Torneio'}) %>
<main class="container mt-3">
  <div class="row">
    <div class="col-12">
      <h1>Operações de Torneio</h1>
      <hr>
      <h2>Criar Torneio</h2>
      <div>
        <div class="mb-3">
          <label for="torneio_name" class="form-label">Nome da Torneio</label>
          <input type="text" class="form-control" id="torneio_name" placeholder="Digite o nome...">
        </div>
        <div class="mb-3">
          <label for="torneio_data" class="form-label">Data do Torneio</label>
          <input type="date" class="form-control" id="torneio_data">
        </div>
        <div class="mb-3">
          <label for="torneio_premio" class="form-label">Prêmio da Torneio</label>
          <input type="text" class="form-control" id="torneio_premio" placeholder="Digite o premio...">
        </div>
        <div class="mb-3">
          <label for="torneio_jogo_id" class="form-label">Id de Jogo</label>
          <input type="text" class="form-control" id="torneio_jogo_id" placeholder="Digite o id...">
        </div>
        <div class="mb-3">
          <label for="torneio_equipes" class="form-label">Id de Equipes (Separe por Vírgula)</label>
          <input type="text" class="form-control" id="torneio_equipes" placeholder="8291328197sdfd, 34534432819z324, 277549132819f">
        </div>
        <button class="btn btn-primary" onclick="create()">Cadastrar Torneio</button>
      </div>
      <hr>
      <h2>Lista de Torneios</h2>
      <div id="get_torneio" class="row">
        <!-- Generated by JS -->
      </div>
    </div>
  </div>
  
  <template id="cardTemplate">
    <div class="card col-md-3">
      <div class="card-body">
        <h5 id="title" class="card-title">Card title</h5>
        <p id="text" class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
        <p id="premio" class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
        <p id="jogo_id" class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
        <div id="equipes">Jogadores:</div>
        <a id="btn" onclick="del('id')" class="btn btn-danger">Deletar</a>
      </div>
    </div>
  </template>

</main>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
  get()
  function create() {
    let obj = {
      nome: document.getElementById('torneio_name').value,
      data: document.getElementById('torneio_data').value,
      premio: document.getElementById('torneio_premio').value,
      jogo_id: document.getElementById('torneio_jogo_id').value,
      equipes: (document.getElementById('torneio_equipes').value).split(',')
    }
    axios.post('/torneio', obj)
    .then(function(res) {
      console.log('post', res)
    }).catch(function (error) {
      console.log(error);
    })
    .then(function () {
      alert('Torneio Criada com sucesso.')
      get()
    }); 
  }
  function get() {
    axios.get('/torneio')
    .then(function(res) {
      console.log('get', res)
      // Clean
      document.getElementById('get_torneio').innerHTML = ""
      res.data.forEach(item => {
        let template = document.querySelector('#cardTemplate')
        let title = template.content.querySelector('#title')
        let text = template.content.querySelector('#text')
        let premio = template.content.querySelector('#premio')
        let jogo_id = template.content.querySelector('#jogo_id')
        let equipes = template.content.querySelector('#equipes')
        let button = template.content.querySelector('#btn')
        title.textContent = item.nome
        Date.prototype.addDays = function(days) {
          var date = new Date(this.valueOf());
          date.setDate(date.getDate() + days);
          return date;
        }
        text.textContent = 'Data: ' + new Date(item.data).addDays(1).toLocaleDateString("pt-BR")
        premio.textContent = 'Prêmio: ' + item.premio
        jogo_id.textContent = 'Id de Jogo: ' + item.jogo_id
        let node = document.createElement('ul')
        item.equipes.forEach(equipe => {
          let li = document.createElement('li')
          li.innerHTML = equipe
          node.appendChild(li)
        })
        equipes.innerHTML = ""
        equipes.appendChild(node)
        let clone = document.importNode(template.content, true);
        document.getElementById('get_torneio').appendChild(clone)
      })
    }).catch(function (error) {
      console.log(error);
    })
  }
  function del(id) {
    axios.delete('/torneio/' + id)
    .then(function(res) {
      console.log('delete', res)
    }).catch(function (error) {
      console.log(error);
    })
    .then(function () {
      alert('Torneio Deletada com sucesso.')
      get()
    }); 
  }
</script>
<%- include('./includes/footer.ejs') %>