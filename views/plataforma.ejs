<%- include('./includes/header.ejs', {title: 'Operações de Plataforma'}) %>
<main class="container mt-3">
  <div class="row">
    <div class="col-12">
      <h1>Operações de Plataforma</h1>
      <hr>
      <h2>Criar Plataforma</h2>
      <div>
        <div class="mb-3">
          <label for="plataforma_name" class="form-label">Nome da Plataforma</label>
          <input type="text" class="form-control" id="plataforma_name" placeholder="Digite o nome...">
        </div>
        <button class="btn btn-primary" onclick="create()">Cadastrar Plataforma</button>
      </div>
      <hr>
      <h2>Lista de Plataformas</h2>
      <div id="get_plataforma" class="row">
        <!-- Generated by JS -->
      </div>
      <hr>
      <h2>Lista de Plataformas com Jogos (Custom Request)</h2>
      <a href="/plataforma_jogos" target="_blank">Ver raw em nova guia</a>
      <div>
        <code id="get_plataforma_jogo">
          <!-- Generated by JS -->
        </code>
      </div>
    </div>
  </div>
  
  <template id="cardTemplate">
    <div class="card col-md-3">
      <div class="card-body">
        <h5 id="title" class="card-title">Card title</h5>
        <p id="text" class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
        <a id="btn" onclick="del('id')" class="btn btn-danger">Deletar</a>
      </div>
    </div>
  </template>

</main>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
  get()
  getSpecial()
  function create() {
    let obj = {nome: document.getElementById('plataforma_name').value}
    axios.post('/plataforma', obj)
    .then(function(res) {
      console.log('post', res)
    }).catch(function (error) {
      console.log(error);
    })
    .then(function () {
      alert('Plataforma Criada com sucesso.')
      get()
      getSpecial()
    }); 
  }
  function get() {
    axios.get('/plataforma')
    .then(function(res) {
      console.log('get', res)
      // Clean
      document.getElementById('get_plataforma').innerHTML = ""
      res.data.forEach(item => {
        let template = document.querySelector('#cardTemplate')
        let title = template.content.querySelector('#title')
        let text = template.content.querySelector('#text')
        let button = template.content.querySelector('#btn')
        title.textContent = item.nome
        text.textContent = item._id
        button.setAttribute("onclick", "del('" + item._id + "')");
        let clone = document.importNode(template.content, true);
        document.getElementById('get_plataforma').appendChild(clone)
      })
    }).catch(function (error) {
      console.log(error);
    })
  }
  function del(id) {
    axios.delete('/plataforma/' + id)
    .then(function(res) {
      console.log('delete', res)
    }).catch(function (error) {
      console.log(error);
    })
    .then(function () {
      alert('Plataforma Deletada com sucesso.')
      get()
      getSpecial()
    }); 
  }
  function getSpecial() {
    axios.get('/plataforma_jogos')
    .then(function(res) {
      console.log('get', res)
      document.getElementById('get_plataforma_jogo').innerHTML = JSON.stringify(res.data)
    }).catch(function (error) {
      console.log(error);
    })
  }
</script>
<%- include('./includes/footer.ejs') %>