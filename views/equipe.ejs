<%- include('./includes/header.ejs', {title: 'Operações de Equipe'}) %>
<main class="container mt-3">
  <div class="row">
    <div class="col-12">
      <h1>Operações de Equipe</h1>
      <hr>
      <h2>Criar Equipe</h2>
      <div>
        <div class="mb-3">
          <label for="equipe_name" class="form-label">Nome da Equipe</label>
          <input type="text" class="form-control" id="equipe_name" placeholder="Digite o nome...">
        </div>
        <div class="mb-3">
          <label for="equipe_patrocinador" class="form-label">Patrocinador da Equipe</label>
          <input type="text" class="form-control" id="equipe_patrocinador" placeholder="Digite o patrocinador...">
        </div>
        <div class="mb-3">
          <label for="equipe_jogadores" class="form-label">Id de Jogadores (Separe por Vírgula)</label>
          <input type="text" class="form-control" id="equipe_jogadores" placeholder="8291328197sdfd, 34534432819z324, 277549132819f">
        </div>
        <button class="btn btn-primary" onclick="create()">Cadastrar Equipe</button>
      </div>
      <hr>
      <h2>Lista de Equipes</h2>
      <div id="get_equipe" class="row">
        <!-- Generated by JS -->
      </div>
    </div>
  </div>
  
  <template id="cardTemplate">
    <div class="card col-md-3">
      <div class="card-body">
        <h5 id="title" class="card-title">Card title</h5>
        <p id="text" class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
        <div id="jogadores">Jogadores:</div>
        <a id="btn" onclick="del('id')" class="btn btn-danger">Deletar</a>
      </div>
    </div>
  </template>

</main>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
  get()
  function create() {
    let obj = {
      nome: document.getElementById('equipe_name').value,
      patrocinador: document.getElementById('equipe_patrocinador').value,
      jogadores: (document.getElementById('equipe_jogadores').value).split(',')
    }
    axios.post('/equipe', obj)
    .then(function(res) {
      console.log('post', res)
    }).catch(function (error) {
      console.log(error);
    })
    .then(function () {
      alert('Equipe Criada com sucesso.')
      get()
    }); 
  }
  function get() {
    axios.get('/equipe')
    .then(function(res) {
      console.log('get', res)
      // Clean
      document.getElementById('get_equipe').innerHTML = ""
      res.data.forEach(item => {
        let template = document.querySelector('#cardTemplate')
        let title = template.content.querySelector('#title')
        let text = template.content.querySelector('#text')
        let jogadores = template.content.querySelector('#jogadores')
        let button = template.content.querySelector('#btn')
        title.textContent = item.nome
        text.textContent = 'patrocinador: ' + item.patrocinador
        button.setAttribute("onclick", "del('" + item._id + "')");
        let node = document.createElement('ul')
        item.jogadores.forEach(jogador => {
          let li = document.createElement('li')
          li.innerHTML = jogador
          node.appendChild(li)
        })
        jogadores.innerHTML = ""
        jogadores.appendChild(node)
        let clone = document.importNode(template.content, true);
        document.getElementById('get_equipe').appendChild(clone)
      })
    }).catch(function (error) {
      console.log(error);
    })
  }
  function del(id) {
    axios.delete('/equipe/' + id)
    .then(function(res) {
      console.log('delete', res)
    }).catch(function (error) {
      console.log(error);
    })
    .then(function () {
      alert('Equipe Deletada com sucesso.')
      get()
    }); 
  }
</script>
<%- include('./includes/footer.ejs') %>