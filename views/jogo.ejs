<%- include('./includes/header.ejs', {title: 'Operações de Jogo'}) %>
<main class="container mt-3">
  <div class="row">
    <div class="col-12">
      <h1>Operações de Jogo</h1>
      <hr>
      <h2>Criar Jogo</h2>
      <div>
        <div class="mb-3">
          <label for="jogo_name" class="form-label">Nome da Jogo</label>
          <input type="text" class="form-control" id="jogo_name" placeholder="Digite o nome...">
        </div>
        <div class="mb-3">
          <label for="jogo_categoria" class="form-label">Categoria</label>
          <input type="text" class="form-control" id="jogo_categoria" placeholder="Digite o país...">
        </div>
        <div class="mb-3">
          <label for="jogo_plataforma_id" class="form-label">Id de Plataforma</label>
          <input type="text" class="form-control" id="jogo_plataforma_id" placeholder="Digite o id...">
        </div>
        <button class="btn btn-primary" onclick="create()">Cadastrar Jogo</button>
      </div>
      <hr>
      <h2>Lista de Jogos</h2>
      <div id="get_jogo" class="row">
        <!-- Generated by JS -->
      </div>
    </div>
  </div>
  
  <template id="cardTemplate">
    <div class="card col-md-3">
      <div class="card-body">
        <h5 id="title" class="card-title">Card title</h5>
        <p id="text" class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
        <p id="plataforma_id" class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
        <a id="btn" onclick="del('id')" class="btn btn-danger">Deletar</a>
      </div>
    </div>
  </template>

</main>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
  get()
  function create() {
    let obj = {
      nome: document.getElementById('jogo_name').value,
      categoria: document.getElementById('jogo_categoria').value,
      plataforma_id: document.getElementById('jogo_plataforma_id').value
    }
    axios.post('/jogo', obj)
    .then(function(res) {
      console.log('post', res)
    }).catch(function (error) {
      console.log(error);
    })
    .then(function () {
      alert('Jogo Criada com sucesso.')
      get()
    }); 
  }
  function get() {
    axios.get('/jogo')
    .then(function(res) {
      console.log('get', res)
      // Clean
      document.getElementById('get_jogo').innerHTML = ""
      res.data.forEach(item => {
        let template = document.querySelector('#cardTemplate')
        let title = template.content.querySelector('#title')
        let text = template.content.querySelector('#text')
        let plataforma_id = template.content.querySelector('#plataforma_id')
        let button = template.content.querySelector('#btn')
        title.textContent = item.nome
        text.textContent = item.categoria
        plataforma_id.textContent = 'plataforma_id: ' + item.plataforma_id
        let clone = document.importNode(template.content, true);
        document.getElementById('get_jogo').appendChild(clone)
      })
    }).catch(function (error) {
      console.log(error);
    })
  }
  function del(id) {
    axios.delete('/jogo/' + id)
    .then(function(res) {
      console.log('delete', res)
    }).catch(function (error) {
      console.log(error);
    })
    .then(function () {
      alert('Jogo Deletada com sucesso.')
      get()
    }); 
  }
</script>
<%- include('./includes/footer.ejs') %>